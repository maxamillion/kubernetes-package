From b35eecb02955b5c584082f6a3c366c83b44da31b Mon Sep 17 00:00:00 2001
From: Adam Miller <admiller@redhat.com>
Date: Wed, 23 Jul 2014 15:45:38 -0500
Subject: [PATCH] (walters@verbum.org) hack/install-package.sh: New file, add
 unit files; (admiller@redhat.com) add config file, use envs in unit files

---
 init/kubernetes-apiserver.service          |  24 +++++++
 init/kubernetes-controller-manager.service |  16 +++++
 init/kubernetes-kubelet.service            |  26 ++++++++
 init/kubernetes-proxy.service              |  16 +++++
 sysconfig/kubernetes                       | 101 +++++++++++++++++++++++++++++
 5 files changed, 183 insertions(+)
 create mode 100644 init/kubernetes-apiserver.service
 create mode 100644 init/kubernetes-controller-manager.service
 create mode 100644 init/kubernetes-kubelet.service
 create mode 100644 init/kubernetes-proxy.service
 create mode 100644 sysconfig/kubernetes

diff --git a/init/kubernetes-apiserver.service b/init/kubernetes-apiserver.service
new file mode 100644
index 0000000..ff9e006
--- /dev/null
+++ b/init/kubernetes-apiserver.service
@@ -0,0 +1,24 @@
+[Unit]
+Description=Kubernetes API Server
+
+[Service]
+EnvironmentFile=/etc/sysconfig/kubernetes
+ExecStart=/usr/bin/kubernetes-apiserver \
+            --address=${KUBE_API_ADDRESS} \
+            --alsologtostderr=${KUBE_ALSOLOGTOSTDERR} \
+            --api_prefix=${KUBE_API_PREFIX} \
+            --cloud_provider=${KUBE_CLOUD_PROVIDER} \
+            --etcd_servers=${KUBE_ETCD_SERVERS} \
+            --health_check_minions=${KUBE_HEALTH_CHECK_MINIONS} \
+            --logtostderr=${KUBE_LOGTOSTDERR} \
+            --log_dir=${KUBE_LOG_DIR} \
+            --log_flush_frequency=${KUBE_LOG_FLUSH_FREQ} \
+            --machines=${KUBE_MACHINES} \
+            --minion_cache_ttl=${KUBE_MINION_CACHE_TTL} \
+            --minion_port=${KUBE_MINION_PORT} \
+            --minion_regexp=${KUBE_MINION_REGEX} \
+            --port=${KUBE_API_PORT} \
+            --v=${KUBE_API_LOG_LEVEL}
+
+[Install]
+WantedBy=multi-user.target
diff --git a/init/kubernetes-controller-manager.service b/init/kubernetes-controller-manager.service
new file mode 100644
index 0000000..a99f353
--- /dev/null
+++ b/init/kubernetes-controller-manager.service
@@ -0,0 +1,16 @@
+[Unit]
+Description=Kubernetes Controller Manager
+
+[Service]
+EnvironmentFile=/etc/sysconfig/kubernetes
+ExecStart=/usr/bin/kubernetes-controller-manager \
+            --alsologtostderr=${KUBE_ALSOLOGTOSTDERR} \
+            --log_dir=${KUBE_LOG_DIR} \
+            --logtostderr=${KUBE_LOGTOSTDERR} \
+            --log_flush_frequency=${KUBE_LOG_FLUSH_FREQ} \
+            --master=${KUBE_MASTER} \
+            --v=${KUBE_CONTROLLER_MANAGER_LOG_LEVEL}
+            
+
+[Install]
+WantedBy=multi-user.target
diff --git a/init/kubernetes-kubelet.service b/init/kubernetes-kubelet.service
new file mode 100644
index 0000000..3d4ce30
--- /dev/null
+++ b/init/kubernetes-kubelet.service
@@ -0,0 +1,26 @@
+[Unit]
+Description=Kubernetes Kubelet
+
+[Service]
+EnvironmentFile=/etc/sysconfig/kubernetes
+ExecStart=/usr/bin/kubernetes-kubelet \
+            --address=${KUBE_KUBELET_ADDRESS} \
+            --alsologtostderr=${KUBE_ALSOLOGTOSTDERR} \
+            --config=${KUBE_KUBELET_CONFIG} \
+            --docker_endpoint=${KUBE_KUBELET_DOCKER_ENDPOINT} \
+            --etcd_servers=${KUBE_ETCD_SERVERS} \
+            --enable_server=${KUBE_KUBELET_INFO_SERVER} \
+            --file_check_frequency=${KUBE_KUBELET_CONFFILE_CHECK_FREQ} \
+            --hostname_override=${KUBE_KUBELETE_HOSTNAME_OVERRIDE} \
+            --http_check_frequency=${KUBE_KUBELET_HTTP_CHECK_FREQ} \
+            --log_dir=${KUBE_LOG_DIR} \
+            --log_flush_frequency=${KUBE_LOG_FLUSH_FREQ} \
+            --logtostderr=${KUBE_LOGTOSTDERR} \
+            --manifest_url=${KUBE_KUBELET_MANIFEST_URL} \
+            --port=${KUBE_KUBELET_PORT} \
+            --root_dir=${KUBE_KUBELET_ROOT_DIR} \
+            --sync_frequency=${KUBE_KUBELET_SYNC_FREQ} \
+            --v=${KUBE_KUBELET_LOG_LEVEL}
+
+[Install]
+WantedBy=multi-user.target
diff --git a/init/kubernetes-proxy.service b/init/kubernetes-proxy.service
new file mode 100644
index 0000000..a284f6a
--- /dev/null
+++ b/init/kubernetes-proxy.service
@@ -0,0 +1,16 @@
+[Unit]
+Description=Kubernetes Proxy
+
+[Service]
+EnvironmentFile=/etc/sysconfig/kubernetes
+ExecStart=/usr/bin/kubernetes-proxy \
+            --alsologtostderr=${KUBE_ALSOLOGTOSTDERR} \
+            --configfile=${KUBE_PROXY_CONFIG_FILE} \
+            --etcd_servers=${KUBE_ETCD_SERVERS} \
+            --logtostderr=${KUBE_LOGTOSTDERR} \
+            --log_dir=${KUBE_LOG_DIR} \
+            --log_flush_frequency=${KUBE_LOG_FLUSH_FREQ} \
+            --v=${KUBE_PROXY_LOG_LEVEL}
+
+[Install]
+WantedBy=multi-user.target
diff --git a/sysconfig/kubernetes b/sysconfig/kubernetes
new file mode 100644
index 0000000..18274ef
--- /dev/null
+++ b/sysconfig/kubernetes
@@ -0,0 +1,101 @@
+###
+# kubernetes system config
+#
+# The following values are used to configure various aspects of kubernetes
+# services.
+#
+#   kubernetes-apiserver.service
+#   kubernetes-controller-manager.service
+#   kubernetes-kubelet.service
+#   kubernetes-proxy.service
+#
+#
+
+##### GLOBAL
+# These items are used across all service components.
+
+KUBE_MASTER="127.0.0.1:8080"
+
+# Comma delimited list
+KUBE_MACHINES="127.0.0.1"
+
+# Comma delimited list
+KUBE_ETCD_SERVERS="http://127.0.0.1:4001"
+
+KUBE_LOGTOSTDERR="false"
+
+KUBE_ALSOLOGTOSTDERR="false"
+
+# upstream default
+KUBE_LOG_FLUSH_FREQ="5s"
+
+KUBE_LOG_DIR="/var/log/kubernetes/"
+
+KUBE_CLOUD_PROVIDER=''
+
+KUBE_HEALTH_CHECK_MINIONS='false'
+
+# upstream default
+KUBE_MINION_CACHE_TTL="30s"
+
+# upstream default
+KUBE_MINION_PORT="10250"
+
+KUBE_MINION_REGEX=''
+
+##### API SERVER
+# Items specific to kubernetes-apiserver.service
+KUBE_API_ADDRESS="127.0.0.1"
+
+KUBE_API_PORT="8080"
+
+# upstream default
+KUBE_API_PREFIX="/api/v1beta1"
+
+
+# upstream default
+KUBE_API_LOG_LEVEL=0
+
+##### CONTROLLER MANAGER
+# Items specific to kubernetes-controller-manager.service
+KUBE_CONTROLLER_MANAGER_LOG_LEVEL=0
+
+##### KUBELET
+# Items specific to kubernetes-kubelet.service
+KUBE_KUBELET_ADDRESS="127.0.0.1"
+
+KUBE_KUBELET_PORT="10250"
+
+KUBE_KUBELET_HOSTNAME_OVERRIDE="127.0.0.1"
+
+KUBE_KUBELET_CONFIG=''
+
+KUBE_KUBELET_DOCKER_ENDPOINT=''
+
+KUBE_KUBELET_INFO_SERVER="true"
+
+# upstream default
+KUBE_KUBELET_CONFFILE_CHECK_FREQ="20s"
+
+# upstream default
+KUBE_KUBELET_HTTP_CHECK_FREQ="20s"
+
+KUBE_KUBELET_MANIFEST_URL=''
+
+# upstream default
+KUBE_KUBELET_ROOT_DIR='/var/lib/kubelet'
+
+# upstream default
+KUBE_KUBELET_SYNC_FREQ="10s"
+
+# upstream default
+KUBE_KUBELET_LOG_LEVEL=0
+
+##### PROXY
+# Items specific to kubernetes-proxy.service
+
+# upstream default
+KUBE_PROXY_LOG_LEVEL=0
+
+# upstream default
+KUBE_PROXY_CONFIG_FILE='/tmp/proxy_config'
-- 
1.9.3

